@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@using Blazr.RenderState
@inject IBlazrRenderStateService RenderState


<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider CloseButton="true"
                   MaxWidth="MaxWidth.Medium"
                   BackdropClick="false"
                   Position="DialogPosition.Center"
                   CloseOnEscapeKey="true" />
<MudSnackbarProvider />
<CascadingValue Value="_drawerOpen">
    <MudLayout Style="position:absolute;">
        @if (_showSplashScreen && !IsStaticSSR)
        {
            <SplashScreen />
        }
        <NavMenu @rendermode="InteractiveServer" />
            @* Conditionally render @Body based on IsStaticSSR to ensure login flow *@
            @if (IsStaticSSR)
            {
                @Body
            }
            else
            {
                <MudHidden Breakpoint="Breakpoint.MdAndUp" Invert="true">
                    <MudMainContent Style="height:auto; overflow-x: hidden; overflow-y: auto; padding-top:70px; padding-left:25px; padding-right:10px;">
                        @Body
                    </MudMainContent>
                </MudHidden>
                <MudHidden Breakpoint="Breakpoint.SmAndDown" Invert="true">
                    @Body
                </MudHidden>
            }
            }


        <script>
            function submitForm(formId) {
                document.getElementById(formId).submit();
            }
        </script>


    </MudLayout>
</CascadingValue>
@code {
    private bool _drawerOpen = false;
    private bool _showSplashScreen = true; // Splash screen visibility state
    private bool _isFirstRender = true; // To track the first render
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender )
        {
            // Keep the splash screen for 15 seconds after the first render
            _showSplashScreen = false;
            _isFirstRender = false; // Prevent further splash screen rendering
            StateHasChanged(); // Trigger a UI update
        }
    }
    private bool IsStaticSSR => NavigationManager.Uri.Contains("/Account");
}
